angular.module("inspector",["inspector.location","inspector.results","inspector.search","inspector.services","ngRoute"]),angular.module("inspector.location",[]).controller("LocationDisplayController",function(a){this.inspections=a.inspections}).$inject=["ResultService"],angular.module("inspector.results",[]).controller("ResultsDisplayController",function(a,b,c,d){this.results=c.value,this.findByLocationId=function(e){a.id=e,d.getLocationResults(e).then(function(a){var b=a.sort(function(a,b){return a.inspection_date<b.inspection_date?1:a.inspection_date>b.inspection_date?-1:0});c.inspections=b}).then(function(){b.path("/location")})}}).$inject=["$routeParams","$location","ResultService","Search"],angular.module("inspector.search",[]).controller("SearchFormController",function(a,b,c,d,e){this.searchForInfo=function(b){NaN!==Number(b)&&5===b.length?(c.zip=b,d.getZipResults(b).then(function(b){var c=[],d=[];b.forEach(function(a){-1===c.indexOf(a.restaurant_name)&&(c.push(a.restaurant_name),d.push(a))});var f=d.sort(function(a,b){return a.restaurant_name>b.restaurant_name?1:a.restaurant_name<b.restaurant_name?-1:0});e.value=f,a.path("/results")})):(c.name=b,d.getNameResults(b).then(function(b){var c=[],d=[];b.forEach(function(a){-1===c.indexOf(a.restaurant_name)&&(c.push(a.restaurant_name),d.push(a))});var f=d.sort(function(a,b){return a.restaurant_name>b.restaurant_name?1:a.restaurant_name<b.restaurant_name?-1:0});e.value=f,a.path("/results")}))}}).$inject=["$location","$http","$routeParams","Search","ResultService"],angular.module("inspector").config(function(a){a.when("/search",{templateUrl:"../views/search.html",controller:"SearchFormController",controllerAs:"SearchCtrl"}).when("/results",{templateUrl:"../views/results.html",controller:"ResultsDisplayController",controllerAs:"ResultsCtrl"}).when("/location",{templateUrl:"../views/restaurant.html",controller:"LocationDisplayController",controllerAs:"LocationCtrl"}).when("/",{templateUrl:"../views/search.html",controller:"SearchFormController",controllerAs:"SearchCtrl"}).otherwise({redirectTo:"/search"})}),angular.module("inspector.services",[]).factory("Search",function(a){var b=function(b){return a({method:"GET",url:"/api/zip/"+b})["catch"](function(a){console.log("Error in services: ",a)}).then(function(a){return a.data})},c=function(b){return a({method:"GET",url:"/api/street/"+b})["catch"](function(a){console.log("Error in services: ",a)}).then(function(a){return a.data})},d=function(b){return a({method:"GET",url:"/api/name/"+b})["catch"](function(a){console.log("Error in services: ",a)}).then(function(a){return a.data})},e=function(b){return a({method:"GET",url:"/api/location/"+b})["catch"](function(a){console.log("Error in services: ",a)}).then(function(a){return a.data})};return{getZipResults:b,getStreetResults:c,getNameResults:d,getLocationResults:e}}).service("ResultService",function(){this.value="",this.inspections=""});var router=require("express").Router(),Results=require("../models/results_model.js");router.get("/zip/:zip",function(a,b){Results.findByZip(a.params.zip).then(function(a){b.send(a)})}),router.get("/street/:street",function(a,b){Results.findByStreet(a.params.street).then(function(a){b.send(a)})}),router.get("/name/:name",function(a,b){Results.findByName(a.params.name).then(function(a){b.send(a)})}),router.get("/location/:id",function(a,b){Results.findByLocationId(a.params.id).then(function(a){b.send(a)})}),module.exports=router;var request=require("request"),mock_result=require("../../test/server/models/zip_78728_results.js"),Results=module.exports;Results.parseUserInput=function(a){},Results.findByZip=function(a){var b="https://data.austintexas.gov/resource/nguv-n54k.json?zip_code="+a,c={url:b,"X-App-Token":process.env.API_TOKEN};return new Promise(function(a,b){request.get(c,function(b,c,d){return b?(console.log("Error!",b),b):(c.body=JSON.parse(d),void a(c.body))})})},Results.findByName=function(a){var b="https://data.austintexas.gov/resource/nguv-n54k.json?$q="+a,c={url:b,"X-App-Token":process.env.API_TOKEN};return new Promise(function(a,b){request.get(c,function(b,c,d){return b?(console.log("Error!",b),b):(c.body=JSON.parse(d),void a(c.body))})})},Results.findByStreetName=function(a){var b="https://data.austintexas.gov/resource/nguv-n54k.json?zip_code="+a,c={url:b,"X-App-Token":process.env.API_TOKEN};return new Promise(function(a,b){request.get(c,function(b,c,d){return b?(console.log("Error!",b),b):(c.body=JSON.parse(d),void a(c.body))})})},Results.findByLocationId=function(a){var b="https://data.austintexas.gov/resource/nguv-n54k.json?facility_id="+a,c={url:b,"X-App-Token":process.env.API_TOKEN};return new Promise(function(a,b){request.get(c,function(b,c,d){return b?(console.log("Error!",b),b):(c.body=JSON.parse(d),void a(c.body))})})};var express=require("express"),Path=require("path"),morgan=require("morgan");require("es6-promise").polyfill();var routes=express.Router(),results_api=require("./api/results_api.js");routes.use(morgan("dev"));var assetFolder=Path.resolve(__dirname,"../client/");routes.use(express["static"](assetFolder));var angular=Path.resolve(__dirname,"../node_modules/");if(routes.use("/scripts",express["static"](angular)),routes.use("/api",results_api),"test"!==process.env.NODE_ENV){routes.get("/*",function(a,b){b.sendFile(assetFolder+"/index.html")});var app=express();app.use(require("body-parser").json()),app.use("/",routes);var port=process.env.PORT||8080;app.listen(port,function(){console.log("listening on port "+port)})}else module.exports=routes;